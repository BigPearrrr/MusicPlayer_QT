# 同济大学软件学院 2020-2021学年第一学期 数据结构课程项目文档——同心云音乐-基于Qt的网络音乐播放器

## 1. 功能点

### 1.1 下载功能

![shuishou](D:\DSproj\MusicPlayer\DocImg\shuishou.png)

下载功能采用一个`QLineEdit`作为搜索文本框，点击放大镜或者按下回车键， 可以搜索相关的歌曲，默认返回相关性Top10的歌曲。双击后下载会自动加入歌单，下载歌曲以及相关的信息。



### 1.2 下端窗体播放功能

![image-20210108214233959](D:\DSproj\MusicPlayer\DocImg\image-20210108214233959.png)

从左至右依次为上一曲、播放、下一曲、进度条、音量控制、播放模式、歌曲列表显示按钮。点击播放按钮可以实现音乐的播放/暂停。点击上一曲/下一曲可以在有前继歌曲/后继歌曲时播放上一首/下一首歌曲。拖动进度条可以实现对应时间歌曲的播放，点击音量按钮可以设置静音/非静音，拖动音量条可以调整音量大小。点击播放模式按钮可以在顺序播放/随机播放/单曲循环之间切换。点击歌曲列表显示按钮可以查看当前的播放列表。



### 1.3 中部窗体播放栈可视化



![image-20210108214809511](D:\DSproj\MusicPlayer\DocImg\image-20210108214809511.png)

中部窗体设计了一个可视化的播放栈，歌曲播放时，从顶至底部依次显示当前播放的、上一首播放的以及上上首播放歌曲的专辑图片。点按上一首专辑图片即可播放前一首歌曲。



### 1.4 歌曲详情页

![image-20210108215245670](D:\DSproj\MusicPlayer\DocImg\image-20210108215245670.png)

点按左下角的按钮即可进入歌曲详情页，可以看到专辑名和轮播滚动的歌词。

### 1.5 胶片滚动功能

![image-20210108215048299](D:\DSproj\MusicPlayer\DocImg\image-20210108215048299.png)

在音乐播放时点击左下角弹出式的窗口将当前播放的歌曲专辑图片裁剪成圆形放置到黑胶唱片上，当播放时，唱片机的横杆就会放到黑胶唱片上，并且黑胶唱片就会滚动。

### 1.6 歌词轮播功能（待补充）

剩下的你来写吧







## 2. 实现

### 2.1 下载功能的实现

下载功能基于网易云的API实现，在搜索按钮或者回车键按下时，会自动提取出搜索框中的文本并转为字符串形式。然后向`https://api.paugram.com/netease/?title=`  + 该文本的地址发出请求。通过解析返回的Json，得到前十名的歌曲详细信息。根据用户的选择，得到该选项的歌曲ID，并再次向`http://music.163.com/api/song/media?id=` + 歌曲ID发出请求，得到该歌曲的下载链接、歌手名、专辑名、专辑地址等地址，将其转为对象后添加入数据库及相关数据结构中。



### 2.2 下端窗体播放功能的实现

下端窗体的播放功能基于QMediaPlayer以及QMediaPlayList实现。QMediaPlayer在播放歌曲时，会发射valueChanged()信号。因此，设计了一个槽函数onDurationChanged()用来更新进度条。而播放模式的设置则是根据用户累积点按的次数决定，若模3余数为0，则为顺序播放；若余数为1，则为随机播放；若余数为2，则为单曲循环。



### 2.3 中部窗体栈可视化实现

中部窗体栈的可视化是基于QPixmap来显示的图片，它加载了本歌曲的专辑图片、上一首歌曲的专辑图片和上上首歌曲的专辑图片，并根据其次序设置图层高低。



### 2.4 歌曲详情页的实现

主页左下角绑定了当前播放歌曲的歌手、歌曲名和专辑图片。点按该按钮后，中部详情页的窗体就被弹出，显示歌曲、歌手、专辑、歌词和专辑图片。



### 2.5 胶片滚动功能的实现

胶片滚动功能的实现基于重写paintEvent函数。首先胶片图层上部加载了一张被裁减为圆形，半径为110的圆形图片，设置中心为黑胶专辑中心。设置了两个计时器，一个来根据当前时间来决定滚动的角度；另一个用来作为横杆的动画时间戳。在歌曲播放后，会将两个计时器开启计时。因此，黑胶唱片就会开始按照帧速无限滚动；并且横杆会向下转动直到30帧结束为止。



